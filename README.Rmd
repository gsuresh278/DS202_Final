---
editor_options: 
  markdown: 
    wrap: 72
---

# DS202_Final

Repo for DS202 final project

```{r}
library(WDI)
library(dplyr)
library(tidyverse)
```

Title: Changes in CO2 Emissions Over Time
Members: Katherine Amundson, Kendra Scace, Gautham Suresh


The data we are using is the CO2 emissions by country dataset. This data
set tracked CO2 emission from different countries in the world from 1750
until 2022.

```{r}
df <- read.csv("CO2 emission by countries.csv")
head(df)
length(df)
nrow(df)
summary(df)
```

There are 9 columns- country, code, calling code, year, Co2 emissions in
tons, population as of 2022, area, percent of world, and density in km2.

Country is the name of the country. Code is the country's abbreviation.
Calling code is the area code in a phone number. Year is the year the
data was observed. CO2 emissions in tons is the recorded amount of CO2
emissions by the country for that year. Population is the number of
people living in the country. Area is the size of the country in
kilometers squared. Percent of world is how much of the Earth the
country takes up. Density in km2 is the density according to the area.

There are 59620 rows of data.

```{r}
drop_na(df)
```

```{r}
# checking for missing values
sum(is.na(df))
# removing rows with any missing values
df_clean <- na.omit(df)
#provides the structure of the dataframe, showing data types and the first few values of each variable, used for understanding the data types of each column
print("Structure: ")
str(df)
# returns the names of the columns in the dataframe
print("Column names: ")
colnames(df)
#returns the class of the object
print("class: ")
sapply(df, class)
# returns the number of unique values for each variable in the dataframe. Helps with understanding the cardinality of each variable
print("unique values: ")
sapply(df, function(x) length(unique(x)))
# remove duplicate rows
df_unique <- unique(df)
# computes the correlation matrix for the numeric variables in the dataframe. Helps with understanding the relationships between different variables
print("correlation matrix: ")
numeric_df <- df[sapply(df, is.numeric)]
cor_matrix <- cor(numeric_df)
print(cor_matrix)
```

**Questions to be addressed**

-   Are currently developing countries polluting at rates similar to
    countries that industrialized earlier
-   Have developed countries taken strides towards reducing pollution in
    the past decade?
-   Have international agreements made any observable impact on
    emissions for participating countries?
    

```{r}
unique_countries <- unique(df$Country)

print(unique_countries)
```

```{r}
df %>%
  filter(CO2.emission..Tons. != 0)
```
```{r}
min_year_data <- df %>%
  group_by(Country) %>%
  filter(CO2.emission..Tons. != 0) %>%
  summarise(Min_Year = min(Year),
            CO2_Emission = CO2.emission..Tons.[which.min(Year)])

print(min_year_data)
```
```{r}
selected_countries <- min_year_data %>%
  filter(Min_Year < 1900)

selected_df <- df %>%
  filter(Country %in% selected_countries$Country)

print(length(unique(selected_df$Country)))

ggplot(selected_df, aes(x = Year, y = CO2.emission..Tons., color = Country)) +
  geom_line() +
  labs(title = "CO2 Emissions of Countries with Min Year < 1900",
       x = "Year",
       y = "CO2 Emission (Tons)") +
  theme_minimal()
```

```{r}
population_threshold <- 75000000  # 75 million

large_countries <- df %>%
  filter(Population.2022. > population_threshold)

print(large_countries)
```

```{r}
countries_agreements <- large_countries %>%
  filter(Year > 1985)

head(countries_agreements)

agreements_years <- ggplot(countries_agreements, aes(x = Year, y = CO2.emission..Tons., color = Country)) +
  geom_line() +
  labs(title = "CO2 Emissions Compared to Dates of International Agreements",
       x = "Year",
       y = "CO2 Emission (Tons)") +
  theme_minimal()
agreements_years + geom_vline(xintercept=1997)
agreements_years + geom_vline(xintercept=2015)
```

```{r}
largest_emissions <- df%>% 
  filter(Year == 2020) %>%
  slice_max(CO2.emission..Tons., n = 10)

print(largest_emissions)

most_emissions_graph<-ggplot(largest_emissions, aes(x=Country, y=CO2.emission..Tons., col=Country)) +
  geom_point(size = 5)

print(most_emissions_graph)
```

```{r}
emissions_2020 <- df %>%
  filter(Year==2020) %>%
  slice_max(Population.2022., n = 20)

highest_population_emissions<-ggplot(emissions_2020, aes(x=Country, y=CO2.emission..Tons., col=Country)) +
  geom_point(size = 5)

print(highest_population_emissions)
```

```{r}
world_map <- map_data("world")

world_map <- world_map %>%
  mutate(region = case_when(
    region == "UK" ~ "United Kingdom",
    region == "USA" ~ "United States",
    TRUE ~ region
  ))

# Filter the data for the year 2020
df_2020 <- df %>% filter(Year == 2020)

# Perform inner join with the world map data
merged_data <- inner_join(world_map, df_2020, by = c("region" = "Country"))

# Plot the global distribution of CO2 emissions for the year 2020
ggplot(merged_data, aes(x = long, y = lat, group = group, fill = CO2.emission..Tons.)) +
  geom_polygon(color = "white") +
  labs(title = "Global Distribution of CO2 Emissions (Year 2020)",
       fill = "CO2 Emissions (Tons)")
```
```{r}
valid_country_codes <- df %>%
  distinct(Code) %>%
  pull(Code)


wdi_data <- WDI(country = valid_country_codes, indicator =c("SP.POP.TOTL", "NY.GDP.MKTP.KD"))

```
```{r}
wdi_data <- left_join(df, wdi_data, by = c("Code" = "iso2c", "Year" = "year"))

# WDI only contains population data from 1960
wdi_data <- wdi_data %>%
  filter(Year >= 1960)
```

```{r}
china_us_data <- wdi_data %>%
  filter(Country %in% c("China", "United States"))

# Plot the pollution rates for China and the US
ggplot(china_us_data, aes(x = Year, y = CO2.emission..Tons., color = Country)) +
  geom_line() +
  labs(title = "CO2 Emissions Comparison: China vs. United States",
       x = "Year",
       y = "CO2 Emissions (Tons)",
       color = "Country")
```
```{r}
us_data <- wdi_data %>%
  filter(Country == "United States")

# Plot population vs. emissions rate for the United States
ggplot(us_data, aes(x = SP.POP.TOTL, y = CO2.emission..Tons.)) +
  geom_point() +
  labs(title = "Population vs. Emissions Rate: United States",
       x = "Population",
       y = "Emissions Rate")

ggplot(us_data, aes(x = SP.POP.TOTL, y = CO2.emission..Tons. / SP.POP.TOTL)) +
  geom_point() +
  labs(title = "Population vs. Emissions Rate: United States",
       x = "Population",
       y = "Emissions Rate (Tons per capita)")
```
```{r}
ggplot(us_data, aes(x = NY.GDP.MKTP.KD, y = CO2.emission..Tons.)) +
  geom_point() +
  labs(title = "GDP vs. CO2 Emissions: United States",
       x = "GDP",
       y = "CO2 Emissions (Tons)")
```

